# -*- coding: utf-8 -*-
"""shopping_flow.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1-5BSQHrmf6QDwBGMkTixB7D0aH5T5tDb
"""

# shopping_flow.py

from typing import List, Optional  # íƒ€ì… íŒíŠ¸ë¥¼ ìœ„í•œ ëª¨ë“ˆ

# âœ… ìƒí’ˆ í´ë˜ìŠ¤: ê°œë³„ ìƒí’ˆì˜ ì •ë³´ë¥¼ ì €ì¥í•˜ëŠ” ê°ì²´
class Product:
    def __init__(self, product_id: int, name: str, brand: str, price: int):
        self.product_id = product_id  # ìƒí’ˆ ê³ ìœ  ID
        self.name = name              # ìƒí’ˆ ì´ë¦„
        self.brand = brand            # ë¸Œëœë“œëª…
        self.price = price            # ê°€ê²©

    def __repr__(self):
        # ìƒí’ˆ ì •ë³´ë¥¼ ë¬¸ìì—´ë¡œ í‘œí˜„í•  ë•Œ ì‚¬ìš©
        return f"{self.name} ({self.brand}) - {self.price}ì›"

# âœ… ìƒí’ˆ ì €ì¥ì†Œ í´ë˜ìŠ¤: ìƒí’ˆ ëª©ë¡ì„ ë³´ê´€í•˜ê³  ê²€ìƒ‰/í•„í„°/ì¡°íšŒ ê¸°ëŠ¥ ì œê³µ
class ProductRepository:
    def __init__(self):
        # ì´ˆê¸° ìƒí’ˆ 10ê°œë¥¼ ë¦¬ìŠ¤íŠ¸ì— ì €ì¥
        self.products = [
            Product(1, "ë¡œì§€í… ë¬´ì„  ë§ˆìš°ìŠ¤", "ë¡œì§€í…", 25000),
            Product(2, "HP ìœ ì„  ë§ˆìš°ìŠ¤", "HP", 15000),
            Product(3, "ë¡œì§€í… ê²Œì´ë° ë§ˆìš°ìŠ¤", "ë¡œì§€í…", 45000),
            Product(4, "ì‚¼ì„± ë¸”ë£¨íˆ¬ìŠ¤ ë§ˆìš°ìŠ¤", "ì‚¼ì„±", 29000),
            Product(5, "LG ìœ ì„  ë§ˆìš°ìŠ¤", "LG", 18000),
            Product(6, "ë¡œì§€í… ë¬´ì„  í‚¤ë³´ë“œ", "ë¡œì§€í…", 32000),
            Product(7, "ì• í”Œ ë§¤ì§ ë§ˆìš°ìŠ¤", "ì• í”Œ", 79000),
            Product(8, "ë¸ ìœ ì„  ë§ˆìš°ìŠ¤", "ë¸", 14000),
            Product(9, "MS ë¸”ë£¨íˆ¬ìŠ¤ ë§ˆìš°ìŠ¤", "MS", 31000),
            Product(10, "ë¡œì§€í… ì‚¬ì¼ëŸ°íŠ¸ ë§ˆìš°ìŠ¤", "ë¡œì§€í…", 27000),
        ]

    # ì „ì²´ ë˜ëŠ” ìµœì‹  ìƒí’ˆ ì¼ë¶€ ë°˜í™˜
    def get_latest_products(self, count: int = 10) -> List[Product]:
        return self.products[:count]

    # í‚¤ì›Œë“œê°€ í¬í•¨ëœ ìƒí’ˆ ê²€ìƒ‰
    def search(self, keyword: str) -> List[Product]:
        return [p for p in self.products if keyword in p.name]

    # ë¸Œëœë“œ ë° ê°€ê²© í•„í„°ë§
    def filter(self, products: List[Product], brand: Optional[str], max_price: Optional[int]) -> List[Product]:
        filtered = products
        if brand:
            filtered = [p for p in filtered if p.brand == brand]
        if max_price:
            filtered = [p for p in filtered if p.price <= max_price]
        return filtered

    # ìƒí’ˆ IDë¡œ ìƒì„¸ ì •ë³´ ì¡°íšŒ
    def get_detail(self, product_id: int) -> Optional[Product]:
        for p in self.products:
            if p.product_id == product_id:
                return p
        return None

# âœ… ì›¹ ì•± í´ë˜ìŠ¤: ì €ì¥ì†Œë¥¼ í†µí•´ ì‚¬ìš©ì ìš”ì²­ì„ ì²˜ë¦¬
class WebApp:
    def __init__(self, repository: ProductRepository):
        self.repo = repository  # ì €ì¥ì†Œ ì£¼ì…

    # ë©”ì¸ í˜ì´ì§€ìš© ìµœì‹  ìƒí’ˆ ë¶ˆëŸ¬ì˜¤ê¸°
    def load_home(self):
        return self.repo.get_latest_products()

    # ê²€ìƒ‰ + í•„í„° + ì •ë ¬ ì²˜ë¦¬
    def search_products(self, keyword: str, brand: Optional[str], max_price: Optional[int]):
        result = self.repo.search(keyword)
        return sorted(self.repo.filter(result, brand, max_price), key=lambda x: x.price)

    # ìƒí’ˆ IDë¡œ ìƒì„¸ ì •ë³´ ë°˜í™˜
    def show_detail(self, product_id: int):
        return self.repo.get_detail(product_id)

# âœ… ì‚¬ìš©ì í´ë˜ìŠ¤: ì‹¤ì œ ì‚¬ìš©ìê°€ ì„œë¹„ìŠ¤ë¥¼ ì´ìš©í•˜ëŠ” íë¦„ì„ ì‹œë®¬ë ˆì´ì…˜
class User:
    def __init__(self, app: WebApp):
        self.app = app

    def run(self):
        print("ğŸ“² ì‡¼í•‘ëª° ì ‘ì†")

        # í™ˆì— ì ‘ì†í–ˆì„ ë•Œ ìµœì‹  ìƒí’ˆ ëª©ë¡ ì¶œë ¥
        latest = self.app.load_home()
        print("ğŸ›’ ìµœì‹  ìƒí’ˆ ë¦¬ìŠ¤íŠ¸:")
        for p in latest:
            print("-", p)

        # 'ë§ˆìš°ìŠ¤' ê²€ìƒ‰ í›„ í•„í„° ì ìš©
        print("\nğŸ” 'ë§ˆìš°ìŠ¤' ê²€ìƒ‰ + ë¡œì§€í… ë¸Œëœë“œ + ê°€ê²© â‰¤ 30000ì›")
        filtered = self.app.search_products("ë§ˆìš°ìŠ¤", "ë¡œì§€í…", 30000)
        for p in filtered:
            print("ğŸ¯ ê²€ìƒ‰ê²°ê³¼:", p)

        # ê²€ìƒ‰ ê²°ê³¼ ì¤‘ ì²« ë²ˆì§¸ ìƒí’ˆ ìƒì„¸ ë³´ê¸°
        if filtered:
            detail = self.app.show_detail(filtered[0].product_id)
            print("\nğŸ“„ ìƒì„¸ í˜ì´ì§€:")
            print("ğŸ“", detail)

# âœ… ë©”ì¸ ì‹¤í–‰ ë¡œì§
if __name__ == "__main__":
    repo = ProductRepository()  # ì €ì¥ì†Œ ìƒì„±
    app = WebApp(repo)          # ì›¹ì•± ìƒì„± (ì €ì¥ì†Œ ì£¼ì…)
    user = User(app)            # ì‚¬ìš©ì ìƒì„± (ì›¹ì•± ì£¼ì…)
    user.run()                  # ì‹œë®¬ë ˆì´ì…˜ ì‹¤í–‰

